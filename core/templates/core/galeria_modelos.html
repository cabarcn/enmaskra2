{% extends 'core/base.html' %}
{% block title %}Galería{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Modelos desde API</h2>

    <div id="contenedor-fotos" class="row">
        {% for foto in fotos %}
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <img src="{{ foto.src.large }}" class="card-img-top" alt="Modelo Pexels">
                    <div class="card-body">
                        <h5 class="card-title text-truncate">{{ foto.photographer }}</h5>
                        <a href="{{ foto.url }}" target="_blank" class="btn btn-primary btn-sm">Ver Detalles</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    {% if not fotos %}
        <p class="text-center text-muted">No se encontraron fotos.</p>
    {% endif %}

    <div class="text-center mt-4">
        <button id="btn-cargar-mas" class="btn btn-dark">Cargar más</button>
    </div>
</div>

<script>
    let page = 2; // Ya se cargó la página 1 en el primer render

    document.getElementById('btn-cargar-mas').addEventListener('click', function () {
        fetch(`/galeria/ajax/?page=${page}`)
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('contenedor-fotos');
                if (data.photos.length === 0) {
                    // Si no hay más resultados, ocultar el botón
                    document.getElementById('btn-cargar-mas').style.display = 'none';
                } else {
                    data.photos.forEach(foto => {
                        const div = document.createElement('div');
                        div.className = 'col-md-4 mb-4';
                        div.innerHTML = `
                            <div class="card h-100 shadow-sm">
                                <img src="${foto.src.large}" class="card-img-top" alt="Modelo">
                                <div class="card-body">
                                    <h5 class="card-title text-truncate">${foto.photographer}</h5>
                                    <a href="${foto.url}" target="_blank" class="btn btn-primary btn-sm">Ver Detalles</a>
                                </div>
                            </div>
                        `;
                        container.appendChild(div);
                    });
                    page++;
                }
            })
            .catch(err => {
                alert("Error al cargar más fotos.");
                console.error(err);
            });
    });
</script>
{% endblock %}
