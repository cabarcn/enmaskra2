{% extends 'core/base.html' %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Panel de Administración</h2>

    <a href="{% url 'admin_reportes' %}" class="btn btn-warning mb-3">Gestión de Reportes de Contenido</a>



    <ul class="nav nav-tabs" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="usuarios-tab" data-bs-toggle="tab" data-bs-target="#usuarios" type="button" role="tab">Usuarios</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="contenido-tab" data-bs-toggle="tab" data-bs-target="#contenido" type="button" role="tab">Contenido</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="reportes-tab" data-bs-toggle="tab" data-bs-target="#reportes" type="button" role="tab">Reportes</button>
        </li>
    </ul>

    <div class="tab-content mt-3" id="adminTabsContent">
        <!-- Usuarios -->
        <div class="tab-pane fade show active" id="usuarios" role="tabpanel">
            <h5 class="mt-3">Gestión de Usuarios</h5>
            <table class="table table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Usuario</th>
                        <th>Correo</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th>Verificado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for perfil in perfiles %}
                    <tr>
                        <td>{{ perfil.user.username }}</td>
                        <td>{{ perfil.user.email }}</td>
                        <td>{{ perfil.rol }}</td>
                        <td>
                            {% if perfil.user.is_active %}
                                <span class="badge bg-success">Activo</span>
                            {% else %}
                                <span class="badge bg-danger">Suspendido</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if perfil.is_verified %}
                                <span class="badge bg-primary">Sí</span>
                            {% else %}
                                <span class="badge bg-secondary">No</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if not perfil.user.is_superuser %}
                            <a href="{% url 'toggle_usuario' perfil.user.id %}" class="btn btn-sm btn-outline-warning">
                                {% if perfil.user.is_active %}Suspender{% else %}Activar{% endif %}
                            </a>
                            <a href="{% url 'editar_usuario' perfil.user.id %}" class="btn btn-sm btn-outline-primary ms-1">
                                Editar
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Contenido -->
        <div class="tab-pane fade" id="contenido" role="tabpanel">
            <h5 class="mt-3">Revisión de Contenido</h5>
            <table class="table table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Título</th>
                        <th>Usuario</th>
                        <th>Fecha</th>
                        <th>Tipo</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in contenidos %}
                    <tr>
                        <td>{{ c.titulo }}</td>
                        <td>{{ c.usuario.username }}</td>
                        <td>{{ c.creado_en|date:"d/m/Y H:i" }}</td>
                        <td>{{ c.tipo }}</td>
                        <td>
                            {% if c.activo %}
                                <span class="badge bg-success">Publicado</span>
                            {% else %}
                                <span class="badge bg-secondary">Despublicado</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'toggle_contenido' c.id %}" class="btn btn-sm btn-outline-secondary">
                                {% if c.activo %}Despublicar{% else %}Publicar{% endif %}
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Reportes -->
        <div class="tab-pane fade" id="reportes" role="tabpanel">
            <h5 class="mt-3">Reportes de Compras</h5>
            <table class="table table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Usuario</th>
                        <th>Contenido</th>
                        <th>Monto</th>
                        <th>Estado</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody>
                    {% for compra in compras %}
                    <tr>
                        <td>{{ compra.usuario.username }}</td>
                        <td>{{ compra.contenido.titulo }}</td>
                        <td>${{ compra.monto }}</td>
                        <td>
                            {% if compra.estado == 'pagado' %}
                                <span class="badge bg-success">Pagado</span>
                            {% else %}
                                <span class="badge bg-warning text-dark">{{ compra.estado }}</span>
                            {% endif %}
                        </td>
                        <td>{{ compra.fecha|date:"d/m/Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
